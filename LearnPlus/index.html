<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <link rel="stylesheet" type="text/css" href="index.css" />
    <title>LearnPlus</title>
  </head>
  <body>
    <div id="app">
      <header id="header-section">
        <nav>
          <ul>
            <li><a href="#home">{{ home }}</a></li>
            <li><a href="#courses">{{ courses }}</a></li>
            <div id="icon">
              <button @click="toggleCart">
                {{ cartVisible ? 'View items' : 'Cart' }}
                <i class="fa-solid fa-cart-shopping"></i>
              </button>
            </div>
          </ul>
        </nav>
      </header>
      <div id="main-section">
        <section class="hero">
          <h1>{{ message }}</h1>
          <div id="search-bar">
            <i class="fa-solid fa-magnifying-glass search-icon"></i>
            <input
              type="text"
              v-model="searchQuery"
              class="search-input"
              placeholder="Search courses..."
            />
            </div>
          <p>{{ message1 }}</p>
        </section>
        <div v-if="!cartVisible">
          <div>
            <label for="sort">SortBy:</label>
            <select v-model="sortAttribute" @change="sortLessons">
              <option value="subject">Subject</option>
              <option value="location">Location</option>
              <option value="price">Price</option>
              <option value="space">Space</option>
            </select>
            <button @click="toggleOrder">
              {{ sortOrder === 1 ? 'Ascending' : 'Descending' }}
            </button>
          </div>
        </div>
        <div id="box">
          <div v-for="item in items" :key="item.itemId" class="item">
            <img :src="item.image" alt="images" />
            <div class="item-info">
              <p>Subject: {{ item.subject }}</p>
              <p>Location: {{ item.location }}</p>
              <p>Price: &#xa3;{{ item.price }}</p>
              <p>Space: {{ item.space }}</p>
            </div>
            <button :disabled="item.space === 0" @click="addToCart(item)">
              Add to cart
            </button>
          </div>
        </div>

        <div v-if="cartVisible" class="cart">
          <h2>Your Cart</h2>
          <div v-for="lesson in cart" :key="lesson.id" class="item">
            <div class="item-info">
              <h3>{{ lesson.subject}}</h3>
              <p1>Quantity: {{ lesson.quantity }}</p1>
            </div>
            <button @click="removeFromCart(lesson)">
              <i class="fas fa-trash"></i> Remove
            </button>
          </div>
          <!-- check out  -->
          <form @submit.prevent="checkout">
            <input v-model="name"
            type="text"
            placeholder="Name"/>
            <input v-model="phone"
            type="text"
            placeholder="Phone Number"/>
            <button :disabled="!validInput" type="submit">Checkout</button>
            </form>
            <div v-if="checkoutMessage" class="checkout-message">
              {{checkoutMessage}}
            </div>

        </div>
      </div>
    </div>

    <script>
      new Vue({
        el: "#app",
        data: {
          home: "Home",
          courses: "Courses",
          message: "Welcome to LearnPlus",
          message1: "Explore the best courses available.",
          items: [
            {
              itemId: 1001,
              image: "images/maths.jpg",
              subject: "Mathematics",
              location: "London",
              price: 100,
              space: 5,
            },
            {
              itemId: 1002,
              image: "images/science.jpg",
              subject: "Science",
              location: "Manchester",
              price: 229,
              space: 5,
            },
            {
              itemId: 1003,
              image: "images/art.jpg",
              subject: "Art",
              location: "leichester",
              price: 486,
              space: 5,
            },
            {
              itemId: 1004,
              image: "images/socialstudies.jpeg",
              subject: "Social Studies",
              location: "Chester",
              price: 60,
              space:5,
            },
            {
              itemId: 1005,
              image: "images/french.jpeg",
              subject: "French",
              location: "New Castle",
              price: 180,
              space: 5,
            },
            {
              itemId: 1006,
              image: "images/programming.jpeg",
              subject: "Programming for kids",
              location: "Bradford",
              price: 860,
              space: 5,
            },
            {
              itemId: 1007,
              image: "images/history.jpeg",
              subject: "History",
              location: "Winchester",
              price: 240,
              space: 5,
            },
            {
              itemId: 1008,
              image: "images/english.jpeg",
              subject: "English",
              location: "Sheffield",
              price: 610,
              space: 5,
            },
            {
              itemId: 1009,
              image: "images/physical.jpeg",
              subject: "Physical Education",
              location: "Yorkshire",
              price: 170,
              space: 5,
            },
            {
              itemId: 1010,
              image: "images/music_class.png",
              subject: "Music",
              location: "Chester",
              price: 285,
              space: 5,
            },
          ],
          cart: [],
          cartVisible: false,
          sortAttribute: "subject",
          sortOrder: 1,
          name:"",
          phone:"",
          checkoutMessage:"",

        },
        methods: {
          toggleCart() {
            this.cartVisible = !this.cartVisible;
          },
          addToCart(item) {
            const cartItem = this.cart.find(
              (lesson) => lesson.itemId === item.itemId
            );
            if (cartItem) {
              cartItem.quantity++;
            } else {
              this.cart.push({...item, quantity: 1});
            }
            item.space--;
          },
          removeFromCart(lesson) {
  const cartItem = this.cart.find((item) => item.itemId === lesson.itemId);
  const originalItem = this.items.find((item) => item.itemId === lesson.itemId);

  if (cartItem && originalItem) {
    cartItem.quantity--; // Decrease cart quantity by 1
    originalItem.space++; // Increase available space by 1

    if (cartItem.quantity === 0) {
      // If the quantity reaches 0, remove the item from the cart
      this.cart = this.cart.filter((item) => item.itemId !== lesson.itemId);
    }
  }
},
          sortLessons() {
            this.items.sort((a, b) => {
              if (a[this.sortAttribute] < b[this.sortAttribute])
                return -this.sortOrder;
              if (a[this.sortAttribute] > b[this.sortAttribute])
                return this.sortOrder;
              return 0;
            });
          },
          toggleOrder() {
            this.sortOrder *= -1;
            this.sortLessons();
          },
          checkout() {
            this.checkoutMessage = `Thank you, ${this.name}! Your order has been placed.`;
            this.cart = [];
            this.name = "";
            this.phone = "";
          },
        },
        computed:{
          validInput(){
            const nameValid = /^[a-zA-Z\s]+$/.test(this.name);
            const phoneValid = /^[0-9]+$/.test(this.phone);
            return nameValid && phoneValid;
          }
        }
      });
    </script>
  </body>
</html>
